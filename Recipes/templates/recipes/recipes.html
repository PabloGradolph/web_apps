{% extends "base.html" %}

{% block title %}
Recipe
{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/recipes.css') }}">
<!-- SWIPER CSS-->
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
/>
{% endblock %}

{% block content %}

{% if current_user.is_authenticated %} 
    {% if is_bookmarked %}
    <form action="{{ url_for('main.bookmark_recipe', recipe_id=recipe.id) }}" method="post" class="bookmark-form">
        <button type="submit" class="bookmark-button unbookmark">🤎 Unbookmark</button>
    </form>
    {% else %}
    <form action="{{ url_for('main.bookmark_recipe', recipe_id=recipe.id) }}" method="post" class="bookmark-form">
        <button type="submit" class="bookmark-button bookmark">🤍 Bookmark</button>
    </form>
    {% endif %}
{% endif %}


<h1 class="recipe-title">{{ recipe.title }}</h1>
<div class="user-image">
    <img src="{{ url_for('static', filename='photos/' + user.profile_image) }}" alt="Profile Picture">
    <span class="user"> Submitted by chef <a href="{{ url_for('main.user', user_id=user.id) }}"> {{ user.username }}</a></span>    
</div>


<div class="recipe-info">
    <div class="recipe-servings">
        <h3>👥 <span class="servings-count">{{ recipe.servings }}</span></h3>
    </div>
    <div class="recipe-cook_time">
        <h3>⏲️ <span class="cook_time-count">{{ recipe.cook_time }}'</span></h3>
    </div>
    <div class="recipe-type_food">
        <h3>🍽️ <span class="type_food-count">{{ recipe.type_food }}</span></h3>
    </div>
    <div class="recipe-category_food">
        <h3>🍴 <span class="category_food-count">{{ recipe.category_food }}</span></h3>
    </div>
    <div class="recipe-rating">
        <h3>⭐ <span class="rating-count">{{ rating }} {{ count }}</span></h3>
    </div>
</div>


<div class="recipe-card">
    <div class="card-columns">
        <!-- Column 1 -->
        <div class="card-column1">
            <!-- Tab links -->
            <div class="tab">
                <button class="tablinks" onclick="openTab(event, 'Description', 'tabcontent', 'tablinks')" id="default">📝 Description</button>
                <button class="tablinks" onclick="openTab(event, 'Steps', 'tabcontent', 'tablinks')">🔢 Steps</button>
                <button class="tablinks" onclick="openTab(event, 'Ingredients', 'tabcontent', 'tablinks')">🥕 Ingredients</button>
                <button class="tablinks" onclick="openTab(event, 'Rate', 'tabcontent', 'tablinks')">⭐ Rate</button>
            </div>
            
            <!-- Tab content -->
            <div id="Description" class="tabcontent">
                <h2>📝 Description</h2>
                <p>{{ recipe.description }}</p>
            </div>
            
            <div id="Steps" class="tabcontent">
                <h2>🔢 Steps</h2>
                <ol type="1">
                    {% for step in recipe.steps %}
                        <li>{{ step.sequence_number }}. <span class="step-description">{{ step.description }}</span></li>
                    {% endfor %}
                </ol>
            </div>

            <div id="Ingredients" class="tabcontent">
                <h2>🥕 Ingredients</h2>
                <ul style="list-style-type:circle;">
                    {% for ingredient in ingredients_info %}
                        <li>{{ ingredient.name }}: <span class="ingredient-description">{{ ingredient.quantity }} {{ ingredient.unit_of_measurement }}</span></li>
                    {% endfor %}
                </ul>
            </div>
            
            <div id="Rate" class="tabcontent">
                <h2>⭐ Rate</h2>
                {% if is_rated %}
                    <p> You have rated this recipe with ⭐{{ rating }} </p>
                {% endif %}
                <form method="post" class="rate-form" action="{{ url_for('main.rate_recipe', recipe_id=recipe.id) }}">
                    {% if is_rated %}
                        <label for="rating">Chef, update your rating!</label>
                    {% else %}
                        <label for="rating">Chef, rate this recipe!</label>
                    {% endif %}
                    <p class="rating-area">
                        <input id="radio1" type="radio" name="rating" value="1">
                        <label class="star" for="radio1">⭐</label>
                        <input id="radio2" type="radio" name="rating" value="2">
                        <label class="star" for="radio2">⭐</label>
                        <input id="radio3" type="radio" name="rating" value="3">
                        <label class="star" for="radio3">⭐</label>
                        <input id="radio4" type="radio" name="rating" value="4">
                        <label class="star" for="radio4">⭐</label>
                        <input id="radio5" type="radio" name="rating" value="5">
                        <label class="star" for="radio5">⭐</label>
                    </p>
                    <button type="submit" class="btn-primary">Submit</button>
                </form>
            </div>
        </div>
    
        <!-- Column 2 -->
        <div class="card-column2">
            <!-- Tab links -->
            <div class="tab">
                <button class="tablinks2" onclick="openTab(event, 'Chef Pictures', 'tabcontent2', 'tablinks2')" id="default2">📸 Chef Pictures</button>
                <button class="tablinks2" onclick="openTab(event, 'Users Pictures', 'tabcontent2', 'tablinks2')">📷 Users Pictures</button>
                <button class="tablinks2" onclick="openTab(event, 'Upload Pictures', 'tabcontent2', 'tablinks2')">⤴️ Upload Pictures</button>
            </div>
            <!-- Tab content -->
            <div class="card-image" >
                <div id="Chef Pictures" class="tabcontent2">
                    <h2>📸 Pictures submitted by the Chef</h2>
                    <div class="recipes__container swiper">
                        <div class="swiper-wrapper">
                            <!--Bucle for aquí con las 5 recetas más valoradas-->
                            <div class="recipes__content swiper-slide">
                                <div>
                                    <img src="{{ url_for('static', filename='imgs/photo_recipe.jpg')}}" alt="recipe image" class="recipes__img">
                                </div>
                            </div>
            
                            <div class="recipes__content swiper-slide">
                                <div>
                                    <img src="{{ url_for('static', filename='imgs/photo_recipe.jpg')}}" alt="recipe image" class="recipes__img">
                                </div>
                            </div>
            
                            <div class="recipes__content swiper-slide">
                                <div>
                                    <img src="{{ url_for('static', filename='imgs/photo_recipe.jpg')}}" alt="recipe image" class="recipes__img">
                                </div>
                            </div>
            
                            <div class="recipes__content swiper-slide">
                                <div>
                                    <img src="{{ url_for('static', filename='imgs/photo_recipe.jpg')}}" alt="recipe image" class="recipes__img">
                                </div>
                            </div>
                        </div>
                        
                        <!-- SWIPER ARROWS AND PAGINATION-->
                        <div class="swiper-button-next">
                            <i class="ri-arrow-right-s-line"></i>
                        </div>
                        <div class="swiper-button-prev">
                            <i class="ri-arrow-left-s-line"></i>
                        </div>
                        <div class="swiper-pagination"></div>
                    </div>
                </div>

                <div id="Users Pictures" class="tabcontent2">
                    <h2>📷 Pictures submitted by users</h2>
                    <ul style="list-style-type:circle;">
                        {% for ingredient in ingredients_info %}
                            <li>{{ ingredient.name }}: <span class="ingredient-description">{{ ingredient.quantity }} {{ ingredient.unit_of_measurement }}</span></li>
                        {% endfor %}
                    </ul>
                </div>

                <div id="Upload Pictures" class="tabcontent2">
                    <h2>⤴️ Upload Pictures to the Realm</h2>
                    <form action="#" method="post" enctype="multipart/form-data">
                        <label for="fileUpload">Upload an image:</label>
                        <input type="file" id="fileUpload" name="file">
                        <input type="submit" value="Upload Image" name="submit">
                    </form>
                </div>

            </div>
        </div>
    </div>
</div>


<!-- TABS JS -->
<script>
    function openTab(evt, Name, tab_content, tab_links) {

        console.log(Name);
        console.log(tab_content);
        console.log(tab_links);
        // Declare all variables
        var i, tabcontent, tablinks;

        // Get all elements with class="tabcontent" and hide them
        tabcontent = document.getElementsByClassName(tab_content);
        console.log(tabcontent);
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }

        // Get all elements with class="tablinks" and remove the class "active"
        tablinks = document.getElementsByClassName(tab_links);
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }

        // Show the current tab, and add an "active" class to the button that opened the tab
        document.getElementById(Name).style.display = "block";
        evt.currentTarget.className += " active";
        }

        // Get the element with id="default" and click on it
        window.onload = function() {
            // Get the element with id="default" and click on it
            document.getElementById("default").click();
            document.getElementById("default2").click();
        };
</script>

<!-- STARS JS -->

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const stars = document.querySelectorAll('.rating-area .star');
    
        stars.forEach(star => {
            star.addEventListener('click', function () {
                let clickedIndex = Array.from(stars).indexOf(star);
                stars.forEach((s, index) => {
                    if (index <= clickedIndex) {
                        s.classList.add('enlarged');
                    } else {
                        s.classList.remove('enlarged');
                    }
                });
            });
        });
    });
    </script>
    


<!-- SWIPER JS -->
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script>
    let swiper = new Swiper(".swiper", {
        loop: true,
        spaceBetween: 24,

        navigation: {
            nextEl: ".swiper-button-next",
            prevEl: ".swiper-button-prev",
        },
        pagination: {
            el: ".swiper-pagination",
        },
        breakpoints: {
            1200: {
                slidesPerView: 2,
                spaceBetween: 0,
            }
        },
    });

    window.addEventListener('load', function() {
        var slides = document.querySelectorAll('.swiper-slide');
        slides.forEach(function(slide) {
            slide.style.marginRight = '0px';
        });
    });
</script>


{% endblock %}
